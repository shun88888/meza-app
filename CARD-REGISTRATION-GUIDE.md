# ğŸ’³ ã‚«ãƒ¼ãƒ‰ç™»éŒ²å®Œå…¨ã‚¬ã‚¤ãƒ‰

Mezaã‚¢ãƒ—ãƒªã§ã®Stripe Elements ã‚’ä½¿ç”¨ã—ãŸå®‰å…¨ãªã‚«ãƒ¼ãƒ‰ç™»éŒ²æ©Ÿèƒ½

## âœ… å®Ÿè£…å†…å®¹

### ğŸ”’ **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ”¹å–„**
- âŒ ç”Ÿã®ã‚«ãƒ¼ãƒ‰æƒ…å ±ã‚’ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã—ãªã„
- âœ… Stripe Elements ã«ã‚ˆã‚‹å®‰å…¨ãªå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ 
- âœ… PCI DSS æº–æ‹ ã®ã‚«ãƒ¼ãƒ‰æƒ…å ±å‡¦ç†
- âœ… PaymentMethod API ä½¿ç”¨

### ğŸ—‘ï¸ **å‰Šé™¤ã•ã‚ŒãŸæ©Ÿèƒ½**
- âŒ ãƒ†ã‚¹ãƒˆã‚«ãƒ¼ãƒ‰ç™»éŒ²ãƒœã‚¿ãƒ³
- âŒ é–‹ç™ºç”¨ãƒ€ãƒŸãƒ¼ã‚«ãƒ¼ãƒ‰æ©Ÿèƒ½
- âŒ ç”Ÿã‚«ãƒ¼ãƒ‰æƒ…å ±ã®ç›´æ¥é€ä¿¡

### ğŸ”§ **æ–°ã—ã„å®Ÿè£…**
- âœ… `StripeCardForm` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- âœ… Stripe Elements çµ±åˆ
- âœ… PaymentMethod ãƒ™ãƒ¼ã‚¹ API
- âœ… é¡§å®¢ç®¡ç†ã¨ã‚«ãƒ¼ãƒ‰ã‚¢ã‚¿ãƒƒãƒ

## ğŸ§ª ãƒ†ã‚¹ãƒˆæ–¹æ³•

### 1. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•

```bash
npm run dev
# ã‚¢ã‚¯ã‚»ã‚¹: http://localhost:3000
```

### 2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ»ãƒ­ã‚°ã‚¤ãƒ³

1. ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ã¾ãŸã¯ãƒ­ã‚°ã‚¤ãƒ³
2. è¨­å®šãƒšãƒ¼ã‚¸ã«ç§»å‹•: `/settings`
3. ã€Œæ±ºæ¸ˆæ–¹æ³•ã€ã‚’é¸æŠ

### 3. ã‚«ãƒ¼ãƒ‰ç™»éŒ²ãƒ†ã‚¹ãƒˆ

**URL**: `http://localhost:3000/settings/payment/add`

#### Stripeãƒ†ã‚¹ãƒˆã‚«ãƒ¼ãƒ‰ç•ªå·

| ã‚«ãƒ¼ãƒ‰ãƒ–ãƒ©ãƒ³ãƒ‰ | ã‚«ãƒ¼ãƒ‰ç•ªå· | CVC | æœ‰åŠ¹æœŸé™ |
|------------|----------|-----|---------|
| **Visa** | `4242424242424242` | `123` | `12/25` |
| **Visa (æ‹’å¦)** | `4000000000000002` | `123` | `12/25` |
| **Mastercard** | `5555555555554444` | `123` | `12/25` |
| **JCB** | `3530111333300000` | `1234` | `12/25` |
| **American Express** | `378282246310005` | `1234` | `12/25` |

#### ãƒ†ã‚¹ãƒˆæ‰‹é †

1. **ã‚«ãƒ¼ãƒ‰åç¾©äºº**: `YAMADA TARO`
2. **ã‚«ãƒ¼ãƒ‰æƒ…å ±**: ä¸Šè¨˜ã®ãƒ†ã‚¹ãƒˆã‚«ãƒ¼ãƒ‰ç•ªå·ã‚’å…¥åŠ›
3. **ç™»éŒ²ãƒœã‚¿ãƒ³**ã‚’ã‚¯ãƒªãƒƒã‚¯
4. Stripe ã«ã‚ˆã‚‹å‡¦ç†ã‚’å¾…æ©Ÿ
5. æˆåŠŸæ™‚ã¯è‡ªå‹•çš„ã«æ±ºæ¸ˆè¨­å®šãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹

### 4. ç™»éŒ²ç¢ºèª

- è¨­å®šãƒšãƒ¼ã‚¸ã§ç™»éŒ²ã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰ã‚’ç¢ºèª
- ã‚«ãƒ¼ãƒ‰ä¸‹4æ¡ã¨ãƒ–ãƒ©ãƒ³ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- å‰Šé™¤æ©Ÿèƒ½ã‚‚å‹•ä½œç¢ºèª

## ğŸ” å‹•ä½œç¢ºèªãƒã‚¤ãƒ³ãƒˆ

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- [ ] Stripe Elements ãŒæ­£å¸¸ã«è¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã‚«ãƒ¼ãƒ‰æƒ…å ±ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé©åˆ‡ã«è¡¨ç¤º
- [ ] æˆåŠŸæ™‚ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- [ ] PaymentMethod ãŒ Stripe ã§ä½œæˆã•ã‚Œã‚‹
- [ ] é¡§å®¢ãŒä½œæˆã¾ãŸã¯ãƒªãƒ³ã‚¯ã•ã‚Œã‚‹
- [ ] Supabase ã«ã‚«ãƒ¼ãƒ‰æƒ…å ±ãŒä¿å­˜ã•ã‚Œã‚‹
- [ ] ã‚¨ãƒ©ãƒ¼æ™‚ã®é©åˆ‡ãªãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯

### Stripe Dashboard
- [ ] PaymentMethod ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] Customer ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] PaymentMethod ãŒ Customer ã«ã‚¢ã‚¿ãƒƒãƒã•ã‚Œã¦ã„ã‚‹

## ğŸš¨ ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆ

### 1. ç„¡åŠ¹ãªã‚«ãƒ¼ãƒ‰ç•ªå·

```
ã‚«ãƒ¼ãƒ‰ç•ªå·: 4000000000000002
çµæœ: "Your card was declined."
```

### 2. æœŸé™åˆ‡ã‚Œã‚«ãƒ¼ãƒ‰

```
ã‚«ãƒ¼ãƒ‰ç•ªå·: 4000000000000069
çµæœ: "Your card has expired."
```

### 3. CVCã‚¨ãƒ©ãƒ¼

```
ã‚«ãƒ¼ãƒ‰ç•ªå·: 4000000000000127
çµæœ: "Your card's security code is incorrect."
```

### 4. æ®‹é«˜ä¸è¶³

```
ã‚«ãƒ¼ãƒ‰ç•ªå·: 4000000000009995
çµæœ: "Your card has insufficient funds."
```

## ğŸ”§ é–‹ç™ºè€…å‘ã‘ãƒ‡ãƒãƒƒã‚°

### ãƒ­ã‚°ç¢ºèª

```bash
# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®ãƒ­ã‚°ã‚’ç›£è¦–
npm run dev

# Stripeã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ã‚’ç›£è¦–
stripe logs tail
```

### Webhook ãƒ†ã‚¹ãƒˆ

```bash
# Webhook ãƒªã‚¹ãƒ‹ãƒ³ã‚°é–‹å§‹
stripe listen --forward-to localhost:3000/api/webhooks/stripe

# PaymentMethodä½œæˆã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒˆãƒªã‚¬ãƒ¼
stripe trigger payment_method.attached
```

### API ãƒ†ã‚¹ãƒˆ

```bash
# PaymentMethod ä¸€è¦§å–å¾—
curl -H "Authorization: Bearer $(stripe auth --print-access-token)" \
  https://api.stripe.com/v1/payment_methods

# Customer ä¸€è¦§å–å¾—
stripe customers list --limit 5
```

## ğŸ¯ å®Ÿéš›ã®ä½¿ç”¨ãƒ•ãƒ­ãƒ¼

### ãƒ¦ãƒ¼ã‚¶ãƒ¼è¦–ç‚¹
1. ã‚¢ãƒ—ãƒªã«ãƒ­ã‚°ã‚¤ãƒ³
2. è¨­å®š â†’ æ±ºæ¸ˆæ–¹æ³•
3. ã‚«ãƒ¼ãƒ‰è¿½åŠ 
4. å®‰å…¨ãªã‚«ãƒ¼ãƒ‰æƒ…å ±å…¥åŠ›
5. ç™»éŒ²å®Œäº†

### ã‚·ã‚¹ãƒ†ãƒ å‡¦ç†
1. Stripe Elements ã§ã‚«ãƒ¼ãƒ‰æƒ…å ±åé›†
2. PaymentMethod ä½œæˆ
3. Customer ä½œæˆ/å–å¾—
4. PaymentMethod ã‚¢ã‚¿ãƒƒãƒ
5. Supabase ä¿å­˜
6. UI æ›´æ–°

## ğŸ“š å‚è€ƒãƒªãƒ³ã‚¯

- [Stripe Elements](https://stripe.com/docs/stripe-js)
- [PaymentMethod API](https://stripe.com/docs/api/payment_methods)
- [React Stripe.js](https://github.com/stripe/react-stripe-js)
- [Stripe Test Cards](https://stripe.com/docs/testing#cards)

---

ã“ã‚Œã§æœ¬æ ¼çš„ãªã‚«ãƒ¼ãƒ‰ç™»éŒ²æ©Ÿèƒ½ãŒå®Œæˆã—ã¾ã—ãŸï¼ ğŸ‰