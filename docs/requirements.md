# Meza アプリ要件定義書

## 1. アプリ概要
Mezaは早起きを習慣化するためのチャレンジアプリです。設定した時間に起きて、100m以上移動することで成功となり、失敗した場合はペナルティ金額が自動決済されます。

## 2. 必要な画面と機能

### 2.1 認証・オンボーディング関連
- **ウェルカム画面** (`/welcome`) - アプリ紹介とチュートリアル
- **サインアップ画面** (`/auth/signup`) - 新規ユーザー登録
- **サインイン画面** (`/auth/signin`) - ログイン
- **パスワードリセット画面** (`/auth/forgot-password`, `/auth/reset-password`)
- **オンボーディング画面** (`/onboarding`) - 初回設定
  - プロフィール設定 (`/onboarding/profile`)
  - 決済情報設定 (`/onboarding/payment`)
  - 完了画面 (`/onboarding/complete`)

### 2.2 メイン機能画面
- **ホーム画面** (`/`) - ダッシュボード、現在のチャレンジ状況
- **チャレンジ作成フロー** (`/create-challenge`)
  - 起床時間設定 (`/create-challenge/time`)
  - 場所設定 (`/create-challenge/location`) - 地図機能
  - ペナルティ金額設定 (`/create-challenge/penalty`)
  - 決済情報確認 (`/create-challenge/payment`)
- **アクティブチャレンジ画面** (`/active-challenge`) - 現在進行中のチャレンジ
- **チャレンジ詳細画面** (`/challenge/[id]`) - 個別チャレンジの詳細
- **チャレンジ完了画面** (`/challenge/[id]/complete`) - 成功/失敗結果表示

### 2.3 統計・履歴機能
- **統計画面** (`/stats`) - チャレンジ成功率、統計情報
- **履歴画面** (`/history`) - 過去のチャレンジ履歴、決済履歴

### 2.4 設定・サポート機能
- **設定画面** (`/settings`) - アプリ設定メニュー
  - アカウント情報 (`/settings/account`)
  - 通知設定 (`/settings/notifications`)
  - 決済方法管理 (`/settings/payment`)
  - セキュリティ設定 (`/settings/security`)
  - プライバシー設定 (`/settings/privacy`)
  - アプリについて (`/settings/about`)
- **ヘルプ・FAQ画面** (`/help`, `/faq`) - よくある質問とサポート

### 2.5 決済関連画面
- **決済画面** (`/challenge/[id]/payment`) - Stripe決済処理
- **決済成功画面** (`/challenge/[id]/payment-success`) - 決済完了確認

### 2.6 静的ページ
- **利用規約** (`/terms`) - サービス利用規約
- **プライバシーポリシー** (`/privacy`) - 個人情報保護方針

## 3. 主要機能要件

### 3.1 認証機能
- Supabase認証を使用したユーザー管理
- メール認証、パスワードリセット機能
- セッション管理とセキュリティ

### 3.2 地図・位置情報機能
- 起床場所の設定（Leaflet/OpenStreetMap使用）
- GPS位置情報取得
- 移動距離計算（100m以上の移動検証）
- 地図表示とマーカー配置

### 3.3 決済機能
- Stripe統合による決済処理
- クレジットカード情報の安全な管理
- 自動決済とWebhook処理
- 決済履歴の管理

### 3.4 チャレンジ管理機能
- チャレンジの作成、開始、完了処理
- 成功/失敗判定ロジック
- チャレンジ状態の管理（pending, active, completed, failed）

### 3.5 通知機能
- プッシュ通知（起床時間のリマインダー）
- Web Push API使用

### 3.6 データ管理
- Supabaseデータベースでのデータ永続化
- リアルタイムデータ同期
- データのバックアップと復元

## 4. 技術スタック

### 4.1 フロントエンド
- **フレームワーク**: Next.js 14 (App Router)
- **言語**: TypeScript
- **スタイリング**: Tailwind CSS
- **UIコンポーネント**: Radix UI
- **アイコン**: Lucide React
- **アニメーション**: Framer Motion

### 4.2 バックエンド・インフラ
- **認証・データベース**: Supabase
- **決済**: Stripe
- **地図**: Leaflet + OpenStreetMap
- **プッシュ通知**: Web Push API
- **ホスティング**: Vercel

### 4.3 モバイル対応
- PWA (Progressive Web App)
- レスポンシブデザイン
- タッチジェスチャー対応
- セーフエリア対応

## 5. デザイン要件

### 5.1 カラーパレット
- **プライマリー**: #FFC700 (黄色系)
- **背景**: グレースケール（ライト/ダークモード対応）
- **アクセント**: 成功時は緑、エラー時は赤

### 5.2 タイポグラフィ
- システムフォント使用
- 日本語対応
- モバイルファーストのサイズ設定

### 5.3 UIパターン
- カード型レイアウト
- ボトムナビゲーション
- スワイプジェスチャー
- ガラスモルフィズム効果

## 6. パフォーマンス要件
- 初期ロード時間: 3秒以内
- 地図表示: 1秒以内
- 決済処理: 5秒以内
- オフライン対応（一部機能）

## 7. セキュリティ要件
- HTTPS通信必須
- API認証トークン管理
- 決済情報の暗号化
- CSRF/XSS対策

## 8. アクセシビリティ要件
- WCAG 2.1 AA準拠
- キーボード操作対応
- スクリーンリーダー対応
- カラーコントラスト確保